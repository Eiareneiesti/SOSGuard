<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Real-time Audio Classification</title>

    <style>
        #results {
            font-family: monospace;
            white-space: pre;
        }
    </style>
</head>
<body>
    <h1>Real-time Audio Classification</h1>

    <p>
        <button id="start-listening">Start Listening</button>
        <button id="stop-listening">Stop Listening</button>
    </p>
    <p id="results"></p>

    <script>
        // Initialize Edge Impulse Classifier
        var classifier = new EdgeImpulseClassifier();
        classifier.init().then(() => {
            console.log('Classifier initialized successfully.');
        }).catch(err => {
            console.error('Failed to initialize classifier:', err);
        });

        // Audio context and stream variables
        let audioContext;
        let audioStream;
        let isListening = false;

        // Start listening button
        document.querySelector('#start-listening').onclick = () => {
            startListening();
        };

        // Stop listening button
        document.querySelector('#stop-listening').onclick = () => {
            stopListening();
        };

        // Function to start listening to microphone
        async function startListening() {
            try {
                // Access user's microphone
                audioStream = await navigator.mediaDevices.getUserMedia({ audio: true });
                audioContext = new AudioContext();
                const microphone = audioContext.createMediaStreamSource(audioStream);

                // Start processing audio
                const scriptNode = audioContext.createScriptProcessor(4096, 1, 1);
                scriptNode.onaudioprocess = processAudio;
                microphone.connect(scriptNode);
                scriptNode.connect(audioContext.destination);

                isListening = true;
            } catch (error) {
                console.error('Error accessing microphone:', error);
            }
        }

        // Function to stop listening to microphone
        function stopListening() {
            if (audioStream) {
                audioStream.getTracks().forEach(track => track.stop());
            }
            if (audioContext) {
                audioContext.close();
            }
            isListening = false;
        }

        // Function to process audio for classification
        function processAudio(event) {
            if (!isListening) return;

            const inputData = event.inputBuffer.getChannelData(0);
            // You need to extract features from the inputData here

            // Perform classification using the extracted features
            const classificationResult = classifier.classify(inputData);

            // Display classification result
            document.querySelector('#results').textContent = JSON.stringify(classificationResult, null, 4);
        }
    </script>
</body>
</html>
