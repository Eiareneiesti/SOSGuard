<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Audio Classification Demo</title>

    <style>
        #results {
            font-family: monospace;
            white-space: pre;
        }
    </style>
</head>
<body>
    <h1>Audio Classification Demo</h1>

    <p>
        <button id="start-recording">Start Recording</button>
        <button id="stop-recording" disabled>Stop Recording</button>
    </p>

    <p id="results"></p>

    <script>
        const startRecording = async () => {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                chunks = [];

                mediaRecorder.ondataavailable = (e) => {
                    chunks.push(e.data);
                };

                mediaRecorder.onstop = async () => {
                    const blob = new Blob(chunks, { 'type': 'audio/ogg; codecs=opus' });
                    chunks = [];
                    
                    // Send audio data to server for classification
                    classifyAudio(blob);
                };

                mediaRecorder.start();
                document.getElementById('start-recording').disabled = true;
                document.getElementById('stop-recording').disabled = false;
            } catch (err) {
                console.error('Error: ' + err);
            }
        };

        const stopRecording = () => {
            mediaRecorder.stop();
            document.getElementById('start-recording').disabled = false;
            document.getElementById('stop-recording').disabled = true;
        };

        const classifyAudio = async (audioBlob) => {
            try {
                const response = await fetch('/classify-audio', {
                    method: 'POST',
                    body: audioBlob
                });

                const classificationResult = await response.json();
                displayClassificationResult(classificationResult);
            } catch (err) {
                console.error('Error classifying audio: ', err);
            }
        };

        const displayClassificationResult = (result) => {
            const resultsContainer = document.getElementById('results');
            resultsContainer.textContent = JSON.stringify(result, null, 4);
        };

        let mediaRecorder;
        let chunks = [];

        document.getElementById('start-recording').addEventListener('click', startRecording);
        document.getElementById('stop-recording').addEventListener('click', stopRecording);
    </script>
</body>
</html>


